!function t(e,n,r){function a(i,l){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!l&&c)return c(i,!0);if(o)return o(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(t){var n=e[i][1][t];return a(n?n:t)},u,u.exports,t,e,n,r)}return n[i].exports}for(var o="function"==typeof require&&require,i=0;i<r.length;i++)a(r[i]);return a}({1:[function(t,e,n){"use strict";var r=t("./eventDrops");"function"==typeof define&&define.amd?define("d3.chart.eventDrops",["d3"],function(t){t.chart=t.chart||{},t.chart.eventDrops=r(t)}):window?(window.d3.chart=window.d3.chart||{},window.d3.chart.eventDrops=r(window.d3)):e.exports=r},{"./eventDrops":3}],2:[function(t,e,n){"use strict";var r=t("./util/configurable"),a=t("./filterData"),o={xScale:null,dateFormat:null};e.exports=function(t){function e(e){e.each(function(e){d3.select(this).selectAll("text").remove();var n=t.xScale.domain();d3.select(this).append("text").text(function(){return t.dateFormat(n[0])}).classed("start",!0),d3.select(this).append("text").text(function(){return a(e[0].dates,t.xScale).length+" exams"}).attr("text-anchor","middle").attr("class","times-exam-count").attr("transform","translate("+t.xScale.range()[1]/2+")"),d3.select(this).append("text").text(function(){return t.dateFormat(n[1])}).attr("text-anchor","end").attr("transform","translate("+t.xScale.range()[1]+")").classed("end",!0)})}t=t||{};for(var n in o)t[n]=t[n]||o[n];return r(e,t),e}},{"./filterData":5,"./util/configurable":6}],3:[function(t,e,n){"use strict";var r=t("./util/configurable"),a=t("./eventLine"),o=t("./delimiter");e.exports=function(t){var e={start:new Date(0),end:new Date,minScale:0,maxScale:1/0,width:1e3,margin:{top:60,left:200,bottom:40,right:50},locale:null,axisFormat:null,tickFormat:[[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]],eventHover:null,eventZoom:null,hasDelimiter:!0,hasTopAxis:!0,hasLabels:!0,hasBottomAxis:function(t){return t.length>=10},eventLineColor:"black",eventColor:null};return function(n){function i(e){e.each(function(e){function r(){"[object MouseEvent]"===t.event.sourceEvent.toString()&&m.translate([t.event.translate[0],0]),"[object WheelEvent]"===t.event.sourceEvent.toString()&&m.scale(t.event.scale),f()}function i(){h.select(".delimiter").remove();h.append("g").classed("delimiter",!0).attr("width",d).attr("height",10).attr("transform","translate("+n.margin.left+", "+(n.margin.top-45)+")").call(o({xScale:l,dateFormat:n.locale?n.locale.timeFormat("%d %B %Y"):t.time.format("%d %B %Y")}))}function s(){n.eventZoom&&n.eventZoom(l),n.hasDelimiter&&i()}function u(e){var r=[];n.tickFormat.forEach(function(t){var e=t.slice(0);r.push(e)});var a=n.locale?n.locale.timeFormat.multi(r):t.time.format.multi(r),o=t.svg.axis().scale(l).orient(e).tickFormat(a);"function"==typeof n.axisFormat&&n.axisFormat(o);var i=("bottom"==e?parseInt(v):0)+n.margin.top-40;x.select(".x-axis."+e).remove();x.append("g").classed("x-axis",!0).classed(e,!0).attr("transform","translate("+n.margin.left+", "+i+")").call(o)}function f(){var t="function"==typeof n.hasTopAxis?n.hasTopAxis(e):n.hasTopAxis;t&&u("top");var r="function"==typeof n.hasBottomAxis?n.hasBottomAxis(e):n.hasBottomAxis;r&&u("bottom"),m.size([n.width,p]),x.select(".graph-body").remove();var o=x.append("g").classed("graph-body",!0).attr("transform","translate("+n.margin.left+", "+(n.margin.top-15)+")"),i=o.selectAll("g").data(e);i.enter().append("g").classed("line",!0).attr("transform",function(t){return"translate(0,"+c(t.name)+")"}).style("fill",n.eventLineColor).call(a({xScale:l,eventColor:n.eventColor,hasLabels:n.hasLabels})),i.exit().remove()}var m=t.behavior.zoom().center(null).scaleExtent([n.minScale,n.maxScale]).on("zoom",r);m.on("zoomend",s);var d=n.width-n.margin.right-n.margin.left,v=15*e.length,p=v+n.margin.top+n.margin.bottom;t.select(this).select("svg").remove();var h=t.select(this).append("svg").attr("width",n.width).attr("height",p),x=h.append("g").attr("transform","translate(0, 25)"),g=[],b=[];e.forEach(function(t,e){g.push(t.name),b.push(40*e)}),c.domain(g).range(b);var w=x.append("g").classed("y-axis",!0).attr("transform","translate(0, 60)"),S=w.append("g").selectAll("g").data(g);S.enter().append("g").attr("transform",function(t){return"translate(0, "+c(t)+")"}).append("line").classed("y-tick",!0).attr("x1",n.margin.left).attr("x2",n.margin.left+d),S.exit().remove();var y,D,A=h.append("rect").call(m).classed("zoom",!0).attr("width",d).attr("height",p).attr("transform","translate("+n.margin.left+", 35)");"function"==typeof n.eventHover&&A.on("mousemove",function(e,r){var a=t.event;if(y!=a.clientX||D!=a.clientY){y=a.clientX,D=a.clientY,A.attr("display","none");var o=document.elementFromPoint(t.event.clientX,t.event.clientY);A.attr("display","block"),"circle"===o.tagName&&n.eventHover(o)}}),l.range([0,d]).domain([n.start,n.end]),m.x(l),f(),n.hasDelimiter&&i(),n.eventZoom&&n.eventZoom(l)})}var l=t.time.scale(),c=t.scale.ordinal();n=n||{};for(var s in e)n[s]=n[s]||e[s];return r(i,n),i}}},{"./delimiter":2,"./eventLine":4,"./util/configurable":6}],4:[function(t,e,n){"use strict";var r=t("./util/configurable"),a=t("./filterData"),o={xScale:null};e.exports=function(t){t=t||{xScale:null,eventColor:null};for(var e in o)t[e]=t[e]||o[e];var n=function(e){e.each(function(e){d3.select(this).selectAll("text").remove(),t.hasLabels&&d3.select(this).append("text").text(function(e){var n=a(e.dates,t.xScale).length;return e.name+(n>0?" ("+n+")":"")}).attr("text-anchor","end").attr("transform","translate(-20)").style("fill","black"),d3.select(this).selectAll("circle").remove();var n=d3.select(this).selectAll("circle").data(function(e){return a(e.dates,t.xScale)});n.enter().append("circle").attr("cx",function(e){return t.xScale(e)}).style("fill",t.eventColor).attr("cy",-5).attr("r",10),n.exit().remove()})};return r(n,t),n}},{"./filterData":5,"./util/configurable":6}],5:[function(t,e,n){"use strict";e.exports=function(t,e){t=t||[];var n=[],r=e.range(),a=r[0],o=r[1];return t.forEach(function(t){var r=e(t);a>r||r>o||n.push(t)}),n}},{}],6:[function(t,e,n){e.exports=function(t,e,n){n=n||{};for(var r in e)!function(r){t[r]=function(a){return arguments.length?(e[r]=a,n.hasOwnProperty(r)&&n[r](a),t):e[r]}}(r)}},{}]},{},[1]);/*
 (c) 2014, Vladimir Agafonkin
 simpleheat, a tiny JavaScript library for drawing heatmaps with Canvas
 https://github.com/mourner/simpleheat
*/
!function(){"use strict";function t(i){return this instanceof t?(this._canvas=i="string"==typeof i?document.getElementById(i):i,this._ctx=i.getContext("2d"),this._width=i.width,this._height=i.height,this._max=1,void this.clear()):new t(i)}t.prototype={defaultRadius:25,defaultGradient:{.4:"blue",.6:"cyan",.7:"lime",.8:"yellow",1:"red"},data:function(t){return this._data=t,this},max:function(t){return this._max=t,this},add:function(t){return this._data.push(t),this},clear:function(){return this._data=[],this},radius:function(t,i){i=i||15;var a=this._circle=document.createElement("canvas"),s=a.getContext("2d"),e=this._r=t+i;return a.width=a.height=2*e,s.shadowOffsetX=s.shadowOffsetY=200,s.shadowBlur=i,s.shadowColor="black",s.beginPath(),s.arc(e-200,e-200,t,0,2*Math.PI,!0),s.closePath(),s.fill(),this},gradient:function(t){var i=document.createElement("canvas"),a=i.getContext("2d"),s=a.createLinearGradient(0,0,0,256);i.width=1,i.height=256;for(var e in t)s.addColorStop(e,t[e]);return a.fillStyle=s,a.fillRect(0,0,1,256),this._grad=a.getImageData(0,0,1,256).data,this},draw:function(t){this._circle||this.radius(this.defaultRadius),this._grad||this.gradient(this.defaultGradient);var i=this._ctx;i.clearRect(0,0,this._width,this._height);for(var a,s=0,e=this._data.length;e>s;s++)a=this._data[s],i.globalAlpha=Math.max(a[2]/this._max,t||.05),i.drawImage(this._circle,a[0]-this._r,a[1]-this._r);var n=i.getImageData(0,0,this._width,this._height);return this._colorize(n.data,this._grad),i.putImageData(n,0,0),this},_colorize:function(t,i){for(var a,s=3,e=t.length;e>s;s+=4)a=4*t[s],a&&(t[s-3]=i[a],t[s-2]=i[a+1],t[s-1]=i[a+2])}},window.simpleheat=t}(),/*
 (c) 2014, Vladimir Agafonkin
 Leaflet.heat, a tiny and fast heatmap plugin for Leaflet.
 https://github.com/Leaflet/Leaflet.heat
*/
L.HeatLayer=(L.Layer?L.Layer:L.Class).extend({initialize:function(t,i){this._latlngs=t,L.setOptions(this,i)},setLatLngs:function(t){return this._latlngs=t,this.redraw()},addLatLng:function(t){return this._latlngs.push(t),this.redraw()},setOptions:function(t){return L.setOptions(this,t),this._heat&&this._updateOptions(),this.redraw()},redraw:function(){return!this._heat||this._frame||this._map._animating||(this._frame=L.Util.requestAnimFrame(this._redraw,this)),this},onAdd:function(t){this._map=t,this._canvas||this._initCanvas(),t._panes.overlayPane.appendChild(this._canvas),t.on("moveend",this._reset,this),t.options.zoomAnimation&&L.Browser.any3d&&t.on("zoomanim",this._animateZoom,this),this._reset()},onRemove:function(t){t.getPanes().overlayPane.removeChild(this._canvas),t.off("moveend",this._reset,this),t.options.zoomAnimation&&t.off("zoomanim",this._animateZoom,this)},addTo:function(t){return t.addLayer(this),this},_initCanvas:function(){var t=this._canvas=L.DomUtil.create("canvas","leaflet-heatmap-layer leaflet-layer"),i=this._map.getSize();t.width=i.x,t.height=i.y;var a=this._map.options.zoomAnimation&&L.Browser.any3d;L.DomUtil.addClass(t,"leaflet-zoom-"+(a?"animated":"hide")),this._heat=simpleheat(t),this._updateOptions()},_updateOptions:function(){this._heat.radius(this.options.radius||this._heat.defaultRadius,this.options.blur),this.options.gradient&&this._heat.gradient(this.options.gradient),this.options.max&&this._heat.max(this.options.max)},_reset:function(){var t=this._map.containerPointToLayerPoint([0,0]);L.DomUtil.setPosition(this._canvas,t);var i=this._map.getSize();this._heat._width!==i.x&&(this._canvas.width=this._heat._width=i.x),this._heat._height!==i.y&&(this._canvas.height=this._heat._height=i.y),this._redraw()},_redraw:function(){var t,i,a,s,e,n,h,o,r,_=[],d=this._heat._r,l=this._map.getSize(),m=new L.LatLngBounds(this._map.containerPointToLatLng(L.point([-d,-d])),this._map.containerPointToLatLng(l.add([d,d]))),c=void 0===this.options.maxZoom?this._map.getMaxZoom():this.options.maxZoom,u=1/Math.pow(2,Math.max(0,Math.min(c-this._map.getZoom(),12))),g=d/2,f=[],p=this._map._getMapPanePos(),v=p.x%g,w=p.y%g;for(t=0,i=this._latlngs.length;i>t;t++)if(m.contains(this._latlngs[t])){a=this._map.latLngToContainerPoint(this._latlngs[t]),e=Math.floor((a.x-v)/g)+2,n=Math.floor((a.y-w)/g)+2;var y=void 0!==this._latlngs[t].alt?this._latlngs[t].alt:void 0!==this._latlngs[t][2]?+this._latlngs[t][2]:1;r=y*u,f[n]=f[n]||[],s=f[n][e],s?(s[0]=(s[0]*s[2]+a.x*r)/(s[2]+r),s[1]=(s[1]*s[2]+a.y*r)/(s[2]+r),s[2]+=r):f[n][e]=[a.x,a.y,r]}for(t=0,i=f.length;i>t;t++)if(f[t])for(h=0,o=f[t].length;o>h;h++)s=f[t][h],s&&_.push([Math.round(s[0]),Math.round(s[1]),Math.min(s[2],1)]);this._heat.data(_).draw(this.options.minOpacity),this._frame=null},_animateZoom:function(t){var i=this._map.getZoomScale(t.zoom),a=this._map._getCenterOffset(t.center)._multiplyBy(-i).subtract(this._map._getMapPanePos());L.DomUtil.setTransform?L.DomUtil.setTransform(this._canvas,a,i):this._canvas.style[L.DomUtil.TRANSFORM]=L.DomUtil.getTranslateString(a)+" scale("+i+")"}}),L.heatLayer=function(t,i){return new L.HeatLayer(t,i)};
/* https://github.com/blx/invigilou
   (c) 2015 Ben Cook
*/
(function(){var t,e=[].indexOf||function(t){for(var e=0,a=this.length;a>e;e++)if(e in this&&this[e]===t)return e;return-1};t=function(a){var r,i,n,s,o;return a.domain=[],s=function(t){return t.datetime-a.domain[0]>=0&&a.domain[1]-t.datetime>=0},o=function(t){var e;return e=d3.select(t)},n=function(t,e){var r,i;r=[a._exams[0].datetime,a._exams[a._exams.length-1].datetime],a.domain=r,i=d3.chart.eventDrops().width(930).margin({top:70,left:30,bottom:0,right:30}).start(r[0]).end(r[1]).hasLabels(!1).eventZoom(_.debounce(e,80)),d3.select(t).datum([{name:"exams",dates:_(a._exams).pluck("datetime")}]).call(i)},i=function(){function t(e,a){this.data=e,this.x=d3.scale.linear(),this.y=d3.scale.linear(),this.color=d3.scale.category10(),this.xAxis=d3.svg.axis().scale(this.x).orient("bottom").tickFormat(""),this.yAxis=d3.svg.axis().scale(this.y).orient("left"),this.line=d3.svg.line().interpolate("basis").x(function(t){return this.x(t.datetime)}).y(function(t){return this.y(t.count)}),this.margin={top:5,left:30,right:30,bottom:20},this.width=930-this.margin.left-this.margin.right,this.height=200-this.margin.top-this.margin.bottom,this.x.range([0,this.width]),this.y.range([this.height,0]),this.svg=d3.select(a).append("svg").attr("width",this.width+this.margin.left+this.margin.right).attr("height",this.height+this.margin.top+this.margin.bottom).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.gx=this.svg.append("g").attr("class","x axis").attr("transform","translate(0,"+this.height+")"),this.gy=this.svg.append("g").attr("class","y axis"),this.data=t.preprocessor(this.data),this.y.domain([0,d3.max(this.data,function(t){return d3.max(t.values,function(t){return t.count})})]),this.color.domain(d3.keys(this.data)),this.render()}return t.preprocessor=function(t){return _(t).chain().groupBy("year").map(function(t,e){return{year:+e,values:_(t).chain().countBy("datetime").map(function(t,e){return{datetime:new Date(e),count:t}}).value()}}).filter(function(t){var e;return 1<=(e=t.year)&&4>=e}).value()},t.filter=function(t,e){return _(e).map(function(t){return{year:t.year,values:_(t.values).filter(s)}})},t.prototype.render=function(){var e,r;return r=t.filter(a.domain,this.data),this.x.domain(a.domain),this.gx.call(this.xAxis),this.gy.call(this.yAxis),this.svg.selectAll(".courseyear").remove(),e=this.svg.selectAll(".courseyear").data(r).enter().append("g").attr("class","courseyear"),e.append("path").attr("class","line").attr("d",function(t){return function(e){return t.line(e.values)}}(this)).style("stroke",function(t){return function(e){return t.color(e.year)}}(this)).style("stroke-width",function(t){return.8*t.year}),e.append("text").datum(function(t){return{name:t.year,value:t.values[t.values.length-1]}}).attr("transform",function(t){return function(e){return"translate("+t.x(e.value.datetime)+","+t.y(e.value.count)+")"}}(this)).attr("x",3).attr("dy",".35em").text(function(t){return t.name})},t}(),r=function(){function r(t,e){var a;this.exams=t,this.markerlayer=null,this.heatlayer=null,a=L.tileLayer("//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),this.map=L.map(e,{center:[49.2651,-123.2522],zoom:15,layers:[a]}),this.mapcontrol=L.control.layers({},{}).addTo(this.map)}return r.prototype.filter=function(t){return _(t).filter(s)},r.prototype.render=function(){var r,i,n,s,o,l,h,u,d,m,c,p;if(t=this.filter(this.exams),null!=this.mapcontrol){for(h=_(t).countBy("building"),s=[],d=[],c=[],i=0,o=t.length;o>i;i++)p=t[i],r=a._buildings[p.shortcode],null!=(null!=r?r.lat:void 0)&&null!=(null!=r?r.lng:void 0)&&(s.push([r.lat,r.lng]),m=p.shortcode,e.call(c,m)>=0||(c.push(p.shortcode),d.push(L.marker([r.lat,r.lng]).bindPopup(r.name+": "+h[p.building]))));if(null!=this.heatlayer?this.heatlayer.setLatLngs(s):this.heatlayer=L.heatLayer(s,{radius:25,minOpacity:.2,max:1.1}).addTo(this.map),null!=this.markerlayer)for(this.markerlayer.clearLayers(),n=0,l=d.length;l>n;n++)u=d[n],this.markerlayer.addLayer(u);else this.markerlayer=L.layerGroup(d).addTo(this.map),this.mapcontrol.addOverlay(this.markerlayer,"Markers")}},r}(),a.init=function(){var t;_(a._exams.exams).each(function(t){t.year=t.y,t.coursecode=t.c,t.shortcode=t.s,t.datetime=new Date(1e3*t.d),delete t.y,delete t.c,delete t.s,delete t.d}),a._buildings=a._exams.buildings,a._exams=a._exams.exams,t=function(t){return a.domain=t.domain(),a.map.render(),a.years.render()},n("#times",t),o("#controls"),a.years=new i(a._exams,"#years"),a.years.render(),a.map=new r(a._exams,"map"),a.map.render()},a}(window.exams||{}),t.init()}).call(this);